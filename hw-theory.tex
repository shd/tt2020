\documentclass[10pt,a4paper,oneside]{article}
\usepackage[utf8]{inputenc}
\usepackage[english,russian]{babel}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{enumerate}
\usepackage{stmaryrd}
\usepackage{cmll}
\usepackage{mathrsfs}
\usepackage[left=2cm,right=2cm,top=2cm,bottom=2cm,bindingoffset=0cm]{geometry}
\usepackage{proof}
\usepackage{tikz}
\usepackage{multicol}

\makeatletter
\newcommand{\dotminus}{\mathbin{\text{\@dotminus}}}

\newcommand{\@dotminus}{%
  \ooalign{\hidewidth\raise1ex\hbox{.}\hidewidth\cr$\m@th-$\cr}%
}
\makeatother

\usetikzlibrary{arrows,backgrounds,patterns,matrix,shapes,fit,calc,shadows,plotmarks}

\newtheorem{definition}{Определение}
\begin{document}

\begin{center}{\Large\textsc{\textbf{Теоретические (``малые'') домашние задания}}}\\
             \it Теория типов, ИТМО, М3235-М3239, весна 2020 года\end{center}

\section*{Домашнее задание №1: <<вводная лекция для ТТ и ФП>>}

\begin{enumerate}

\item Напомним определения с лекций:

\begin{tabular}{lll}
Обозначение & лямбда-терм & название\\\hline
$T$ & $\lambda a.\lambda b.a$ & истина\\
$F$ & $\lambda a.\lambda b.b$ & ложь\\
$Not$ & $\lambda x.x\ F\ T$ & отрицание\\
$And$ & $\lambda x.\lambda y.x\ y\ F$ & конъюнкция
\end{tabular}

Проредуцируйте следующие выражения и найдите нормальную форму:

\begin{enumerate}
\item $T\ F$
\item $(T\ Not\ (\lambda t.t))\ F$
\item $And\ F\ T$
\item $And\ T\ T$
\end{enumerate}

\item Постройте лямбда-выражения для следующих булевских выражений:
\begin{enumerate}
\item Дизъюнкция
\item Штрих Шеффера (<<и-не>>)
\item Исключающее или
\end{enumerate}

\item Напомним определения с лекций:

$$f^{(n)}\ X ::= \left\{\begin{array}{ll} X, & n=0\\
                                f^{(n-1)}\ (f\ X), & n>0\end{array}\right.$$

\begin{center}\begin{tabular}{lll}
Обозначение & лямбда-терм & название\\\hline
$\overline{n}$ & $\lambda f.\lambda x.f^{(n)}\ x$ & чёрчевский нумерал\\
$(+1)$ & $\lambda n.\lambda f.\lambda x.n\ f\ (f\ x)$ & прибавление 1\\
$IsZero$ & $\lambda n.n\ (\lambda x.F)\ T$ & проверка на 0
\end{tabular}\end{center}

Используя данные определения, постройте выражения для следующих операций над числами:

\begin{enumerate}
\item Сложение
\item Умножение на 2 ($Mul2$)
\item Умножение
\item Возведение в степень
\item Проверка на чётность
\item Деление на 3 (могут потребоваться пары и/или вычитания)
\item Сравнение двух чисел ($IsLess$) — истина, если первый аргумент меньше второго
(могут потребоваться пары и/или вычитания)
\end{enumerate}

\item Проредуцируйте выражение и найдите его нормальную форму: 
\begin{enumerate}
\item $\overline{2}\ \overline{2}$
\item $\overline{2}\ \overline{2}\ \overline{2}$
\item $\overline{2}\ \overline{2}\ \overline{2}\ \overline{2}\ \overline{2}\ \overline{2}\ \overline{2}$
\end{enumerate}

\item Напомним определения с лекций:

\begin{tabular}{lll}
Обозначение & лямбда-терм & название\\\hline
$MkPair$ & $\lambda a.\lambda b.(\lambda x.x\ a\ b)$ & создание пары\\
$PrL$ & $\lambda p.p\ T$ & левая проекция\\
$PrR$ & $\lambda p.p\ F$ & правая проекция\\\hline
$Case$ & $\lambda l.\lambda r.\lambda c.c\ l\ r$ & case для алгебраического типа\\
$InL$ & $\lambda l.(\lambda x.\lambda y.x\ l)$ & левая инъекция\\
$InR$ & $\lambda r.(\lambda x.\lambda y.y\ r)$ & правая инъекция\\
\end{tabular}

\begin{enumerate}
\item Убедитесь, что $PrL\ (MkPair\ a\ b) \twoheadrightarrow_\beta a$.
\item Убедитесь, что $Case\ (\lambda x.T)\ (\lambda y.y)\ (InR\ p) \twoheadrightarrow_\beta p$.
\item Постройте операцию вычитания 1 из числа
\item Постройте операцию вычитания чисел
\item Постройте опреацию деления чисел
\end{enumerate}

\item Напомним определение Y-комбинатора: $\lambda f.(\lambda x.f\ (x\ x))\ (\lambda x.f\ (x\ x))$.
\begin{enumerate}
\item Покажите, что выражение $Y\ f$ не имеет нормальной формы;
\item Покажите, что выражение $Y\ (\lambda f.\overline{0})$ имеет нормальную форму.
\item Покажите, что выражение $Y\ (\lambda f.\lambda x.(IsZero\ x)\ \overline{0}\ (f\ Minus1\ x))\ 2$ имеет нормальную форму.
\item Какова нормальная форма выражения $Y\ (\lambda f.\lambda x.(IsZero\ x)\ \overline{0}\ ((+1)\ (f\ Minus1\ x)))\ \overline{n}$?
\item Какова нормальная форма выражения $Y\ (\lambda f.\lambda x.(IsZero\ x)\ \overline{1}\ (Mul2\ (f\ Minus1\ x)))\ \overline{n}$?
\item Определите с помощью $Y$-комбинатора функцию для вычисления $n$-го числа Фибоначчи.
\end{enumerate}

\item Пусть $\eta = (\alpha\rightarrow\alpha)\rightarrow(\alpha\rightarrow\alpha)$. Покажите (т.е. постройте
соответствующее доказательство в исчислении по Карри), что:
\begin{enumerate}
\item $\vdash \overline{2} : \eta$.
\item $\vdash (+1) : \eta\rightarrow\eta$.
\item $\vdash Plus : \eta\rightarrow\eta$.
\item $\vdash Mul : \eta\rightarrow\eta$ (не каждая реализация умножения будет удовлетворять этому свойству;
вам требуется найти нужную)
\end{enumerate}

\item Определим на языке Хаскель следующую функцию: \verb!show_church n = show (n (+1) 0)!
Убедитесь, что \verb!show_church (\f -> \x -> f (f x))! вернёт 2. 
Пользуясь данным определением и его идеей, реализуйте следующие функции:

\begin{enumerate}
\item \verb!int_to_church! --- возвращает чёрчевский нумерал (т.е. функцию от двух аргументов) по целому числу.
Каков точный тип результата этой функции?
\item сложение двух чёрчевских нумералов.
\item умножение двух чёрчевских нумералов.
\item можно ли определить вычитание 1 и вычитание? Что получается, а что --- нет?
\end{enumerate}

\item Типы для конъюнкции и дизъюнкции на Хаскеле. Списки.

Заметим, что список (например, целых чисел) — это алгебраический тип: 

\verb!List = Nil | Cons Integer List!.

Можно сконструировать значение данного типа: \verb!Cons 3 (Cons 5 Nil)!.
Можно, например, вычислить его длину:
\begin{verbatim}
length Nil = 0
length (Cons _ tail) = length tail + 1
\end{verbatim}

Определим $Nil = InL\ 0$, а $Cons\ a\ b = InR\ (MkPair\ a\ b)$. Заметим, что теперь списки могут быть впрямую
перенесены в лямбда выражения. Тогда, используя данную идею, реализуйте в Хаскеле:

\begin{enumerate}
\item определите конструкции mkpair, prl, prr на Хаскеле --- какой тип у данных конструкций? Сравните его с типом конъюнкции с лекции.
\item определите конструкции case, inl, inr --- какой тип у данных конструкций? Сравните его с типом дизъюнкции с лекции.
\item постройте список целых чисел из данных конструкий.
\item определите функцию вычисления длины списка целых чисел с помощью данных конструкций (к сожалению, скомпилировать это
выражение на Хаскеле не получится — поэтому достаточно написать исходный код).
\end{enumerate}

\end{enumerate}

\section*{Домашнее задание №2: <<формализация лямбда-исчисления>>}

\begin{enumerate}
\item На лекции было использовано понятие свободы для подстановки. 
\begin{enumerate}
\item Найдите лямбда-выражение, которое при однократной редукции требует переименования связанных переменных
(редукция невозможна без переименования). 
\item Заметим, что даже если мы запретим использовать одни и те же переменные в разных лямбда-абстракциях,
это не будет решением проблемы переименований. Предложите лямбда-выражение, в котором (а) все лямбда-абстракции
указаны по разным переменным; но (б) через некоторое количество редукций потребуется переименование
связанных переменных.
\end{enumerate}

\item Дадим определение: комбинатор --- лямбда-выражение без свободных переменных.

Также напомним определение:
$$\begin{array}{l}
S := \lambda x.\lambda y.\lambda z.x\ z\ (y\ z)\\
K := \lambda x.\lambda y.x\\
I := \lambda x.x
\end{array}$$

Известна теорема о том, что для любого комбинатора $X$ можно найти выражение $P$
(состоящее только из скобок, пробелов и комбинаторов $S$ и $K$), что $X =_\beta P$.
Будем говорить, что комбинатор $P$ \emph{выражает} комбинатор $X$ в базисе $SK$.

Выразите в базисе $SK$:
\begin{enumerate}
\item $F = \lambda x.\lambda y.y$
\item $\overline{1}$
\item $Not$
\item $Xor$
\item $InL$
\item $\overline{n}$
\end{enumerate}

\item Бесконечное количество комбинаторов неподвижной точки. Дадим следующие определения
$$\begin{array}{l}
L := \lambda abcdefghijklmnopqstuvwxyzr.r(thisisafixedpointcombinator)\\
R := LLLLLLLLLLLLLLLLLLLLLLLLLL\end{array}$$
В данном определении терм $R$ является комбинатором неподвижной точки: каков бы ни был терм
$F$, выполнено $R\ F =_\beta F\ (R\ F)$.
\begin{enumerate}
\item Докажите, что данный комбинатор --- действительно комбинатор неподвижной точки.
\item Пусть в качестве имён переменных разрешены русские буквы. Постройте аналогичное выражение
по-русски: с 33 параметрами и осмысленной русской фразой в терме $L$; покажите, что оно является
комбинатором неподвижной точки.
\end{enumerate}

\item Пусть задано $n \in \mathbb{N}$. 
Постройте лямбда-выражение, которое преобразуется в нормальную форму в $n$ раз 
медленнее с помощью нормального порядка редукции, чем с помощью какого-то другого (самого быстрого) 
порядка редукции.

\item Чёрчевские нумералы соответствуют натуральным числам в аксиоматике Пеано.
\begin{enumerate}
\item Предложите <<двоичные нумералы>> --- способ кодирования чисел, аналогичный двоичной системе 
(такой, при котором длина записи числа соответствует логарифму числового значения).
\item Предложите реализацию функции (+1) в данном представлении.
\item Предложите реализацию лямбда-выражения преобразования числа из двоичного нумерала в чёрчевский.
\item Предложите реализацию функции сложения в данном представлении.
\item Предложите реализацию функции вычитания в данном представлении.
\item Какова вычислительная сложность арифметопераций с двоичными нумералами?
\end{enumerate}

\item Предложим альтернативные аксиомы для конъюнкции:

$$\infer[\text{Введ. }\with]{\Gamma\vdash \alpha\with \beta}{\Gamma\vdash \alpha\ \ \ \Gamma\vdash \beta}\quad\quad
  \infer[\text{Удал. }\with]{\Gamma\vdash \gamma}{\Gamma\vdash \alpha\with \beta\ \ \ \Gamma, \alpha, \beta\vdash \gamma}$$

\begin{enumerate}
\item Предложите лямбда-выражения, соответствующие данным аксиомам; поясните, как данные выражения 
абстрагируют понятие <<упорядоченной пары>>.
\item Выразите изложенные в лекции аксиомы конъюнкции через приведённые в условии.
\item Выразите приведённые в условии аксиомы конъюнкции через изложенные в лекции.
\end{enumerate}

\item Как мы уже разбирали, $\not\vdash x\ x:\tau$ в силу дополнительных ограничений
аксиомы
$$\infer[x \notin FV(\Gamma)]{\Gamma, x:\tau\vdash x:\tau}{}$$

Найдите лямбда-выражение $N$, что $\not\vdash N:\tau$ в силу ограничения аксиомы
$$\infer[x \notin FV(\Gamma)]{\Gamma \vdash \lambda x.N:\sigma\to\tau}{\Gamma, x:\sigma \vdash N:\tau}$$


\end{enumerate}

\section*{Домашнее задание №3: <<вывод типов; алгоритм унификации>>}

\begin{enumerate}

\item \emph{Вполне упорядоченным} множеством назовём такое линейно-упорядоченное отношением $(\prec)$ 
множество $S$ (и такой порядок назовём \emph{полным}), 
что какое бы ни было множество $U \subseteq S$, в $U$ найдётся наименьший элемент.
\begin{enumerate}
\item Покажите, что неотрицательные вещественные числа $[0,+\inf)$ --- не вполне упорядоченное множество.
Существуют ли конечные и счётные не вполне упорядоченные множества?
\item Определим лексикографический порядок на $\mathbb{N}^n$: положим, что 
$\langle a_1, a_2, \dots a_n \rangle \prec \langle b_1, b_2, \dots b_n$, если найдётся такой $k$,
что $a_1 = b_1$, ..., $a_{k-1} = b_{k-1}$, но $a_k < b_k$.
Покажите, что такой порядок --- полный.
\item Пусть $S$ вполне упорядочено отношением $(\prec)$, 
определим $a\succ b := b \prec a$. Пусть $a_1 \succ a_2 \succ a_3 \succ \dots$ --- 
строго монотонно убывающая последовательность значений из $S$. Покажите, что данная 
последовательность всегда имеет конечную длину.
\end{enumerate}

\item Рассмотрим полное интуиционистское исчисление высказываний.
Дополните алгоритм вывода типов дополнительными функциональными символами 
для связок $\with$, $\vee$ и $\bot$ (а также сделайте дополнительные 
необходимые исправления в нём) и продемонстрируйте вывод типов для выражения,
использующего хотя бы две из данных трёх конструкций.

\item Поясним название <<алгебраические типы>> --- это семейство составных типов, 
позволяющих строить <<алгебраические>> выражения на типах:

\begin{tabular}{lll}
название & обозначение & алгебраический смысл\\\hline
тип-сумма, <<алгебраический>> & $\alpha\vee\beta$ & $\alpha+\beta$\\
тип-произведение, пара & $\alpha\with\beta$ & $\alpha\times\beta$\\
тип-степень, функция & $\alpha\to\beta$&$\beta^\alpha$
\end{tabular}

Название <<алгебраический>> закрепилось в первую очередь за типом-суммой (видимо потому,
что остальные типы имеют устоявшиеся названия), однако, может быть отнесено и к другим
типам.

Поясните <<типовый>> (программистский) смысл следующих алгебраических тождеств --- и постройте
программы, их доказывающие:
\begin{enumerate}
\item $\gamma\times(\alpha+\beta) = \gamma\times\alpha + \gamma\times\beta$.
\item $\gamma^{\alpha\times\beta} = {(\gamma^\alpha)}^\beta$. Как называется данное тождество?
\item $\gamma^{\alpha+\beta} = \gamma^\alpha\times\gamma^\beta$.
\end{enumerate}

\item Найдите лямбда-выражения, доказывающие:
\begin{enumerate}
\item Формулу де-Моргана $\neg(\alpha\vee\beta)\to\neg\alpha\with\neg\beta$.
\item Контрапозицию $(\alpha\to\beta)\to(\neg\beta\to\neg\alpha)$.
\item Закон исключённого третьего после применения теоремы Гливенко $\neg\neg(\alpha\vee\neg\alpha)$.
\end{enumerate}

\end{enumerate}

\end{document}
